---
title: "Présentation"
author: "Marc XU"
date: "20 mai 2019"
output: 
  revealjs::revealjs_presentation:
    center: no # yes
    highlight: kate
    theme: league
    transition: zoom
    toc: TRUE
---

# Neural network

```{r message = FALSE}
set.seed(799)
#{data-background="neurone.png"}
library("neuralnet")
library("mclust")
library("caret")
library("ROCR")
library("knitr")
library("GGally")

knitr::opts_chunk$set(
  fig.width = 7, fig.height = 6, 
  fig.path = 'figures/iris_',
  fig.align = "center", 
  size = "tiny", 
  echo = FALSE, 
  eval = TRUE, 
  warning = FALSE, 
  message = FALSE, 
  results = TRUE, 
  comment = "")
```

```{r}
# Les fonctions

# La fonction accuracy
acc = function (resultats) {
  return(sum(diag(resultats)) / sum(resultats))
}

# La fonction erreur
err = function (resultats) {
  return(1 - (sum(diag(resultats)) / sum(resultats)))
}

# La fonction sensibilité
sens = function (resultats) {
  if (nrow(resultats) >= 2) {
    return(resultats[2,2] / (resultats[2,2] + resultats[1,2]))
  } else {
    return(NA)
  }
}

# La fonction spécifité
spec = function (resultats) {
  if (nrow(resultats) >= 2) {
    return(resultats[1,1] /(resultats[2,1] + resultats[1,1]))
  } else {
    return(NA)
  }
}

# La fonction F1_Score
scor = function (resultats) {
  return((2 * resultats[2,2]) / (2 * resultats[2,2] + resultats[1,2] + resultats[2,1]))
}

# La fonction ccm
ccm1 = function (resultats) {
  return((resultats[1,1] * resultats[2,2] - resultats[1,2] * resultats[2,1]) / (sqrt((resultats[1,1]+resultats[1,2]) * (resultats[1,1]+resultats[2,1]) * (resultats[2,2]+resultats[1,2]) *  (resultats[2,2]+resultats[2,1]))))
}

# Les fonctions
prediction2 = function (reseau) {
  realite2 = as.numeric(reseau$response)
  prediction2 = reseau$net.result
  results <- data.frame(actual = realite2, prediction = prediction2)
  names(results) <- c("Realité", "Prédiction")
  return(results)
}
perfection2 = function(matrice) {
  acc.app <- acc(matrice)
  err.app <- err(matrice)
  perf.app <- c(acc.app, err.app)
  names(perf.app) <- c("accuracy", "erreur")
  return(perf.app)
}
```

## Déroulé du stage

1. Apprentissage de R avancé <!-- être agile avec R, R studio, Rmarkdown, compilation d'un notebook en .pdf, .html -->

2. Apprentissage de la méthode de prédiction choisie et de sa librairie R sur le jeu de données `Iris de Fisher`
=> éventuellement mettre une image couche/neurone
3. Apprentissage des critères de validation d'un modèle d'apprentissage en classification <!-- Y qualitatif à deux classes -->
<!-- Accuracy, Sensibilité, spécificité, F1-score et courbes ROC-->
<!-- échantillon d'apprentissage versus échantillon de validation -->

4. Application aux données "membranes placentaires"


## Objectifs du stage

1. problématique : établir un modèle permettant de prédire si une molécule donnée traverse la membrane placentaire <!-- importance de la membrane placentaire et du fait de savoir si un composé passe ou non -->
2. méthode : utilisation d'un réseau de neurones

# Les données

jeu de données comportant

- 91 molécules décrites par
- 207 descripteurs calculés avec le logiciel e-dragon
- une mesure de clairance, CI

<!-- Ces données concernent 90 molécules / médicaments dont on souhaitent savoir si elles passent la membrane placentaire. Pour cela, elles ont été testées et leur clairance a été calculée. Wikipédia = "La « clairance d'une substance » est le volume apparent (virtuel) de plasma artériel totalement débarrassé de cette substance donnée par unité de temps". Une clairance a des valeurs entre 0 et 1, 0 veut dire que la molécule ne passe pas la barrière placentaire du tout et une clairance de 1 veut dire que la molécule passe en totalité la barrière placentaire. Il arrive que la clairance soit supérieur à 1. -->

---

** METTRE un premier tableau extrait des données ou on voit 6 molécules, avec leur nom, leur CI et 3-4 descripteurs **

## Nettoyage des données
** METTRE une représentation graphique de la clairance avec et sans Mefloquine (valeur aberrante) boxplot ** => exemple de nettoyage des données

<!-- Au départ, plus de mille descripteurs, donc les données ont été néttoyées, par exemple, les données manquantes, les données aberrantes, les descripteurs non variants ou trop corrélés entre eux ont été éliminés de l'étude -->

## Transformation de la variable "clairance = CI"

** METTRE clairance en deux classe ** = SUPER IMPORTANT = ** histogramme**

## Les réseaux de neurones

**PRESENTATION rapide des NN**
- la théorie des NN
- le package utilisé neuralnet


## Les données PLACENTA
```{r}
setwd("../Marc")
placenta1 = na.omit(read.table(".././data/placenta90.208.Rdata.txt", dec = ".", sep = "\t", header =TRUE))
```

Il y a `r nrow(placenta1)` individus et `r ncol(placenta1)` descripteurs.

```{r}
kable(head(placenta1[,c(1,6:9)]))
```



## Résumés des données
```{r}
kable(do.call(cbind, lapply(placenta1[,c(1,6:9)], summary)), digits = 2)
```

## ACP (sans normalisé)
```{r}
placenta1 = scale(placenta1, center = TRUE, scale = FALSE)
placenta1.acp <- prcomp(as.matrix(placenta1[,2:nrow(placenta1)]))
plot(placenta1.acp)
```

## ACP (sans normalisé)
```{r}
biplot(placenta1.acp)
```

## ACP (normalisé)
```{r}
placenta1 = scale(placenta1, center = TRUE, scale = TRUE)
placenta1.acp <- prcomp(as.matrix(placenta1[,2:nrow(placenta1)]))
vp_pourcent <- cumsum(placenta1.acp$sdev) / sum(placenta1.acp$sdev)
#barplot(vp_pourcent[1:10])
plot(placenta1.acp)
```

## ACP (normalisé)
```{r}
biplot(placenta1.acp)
```

```{r}
# Nettoyage des données

# variances nulles/faibles
var.table <- apply(placenta1[,2:ncol(placenta1)], MARGIN = 2, FUN = var)
#which(var.table <= 0.1)
# aucune variance est nulle

# corrélation des descripteurs
mat.Cor = cor(placenta1)
#findCorrelation(mat.Cor, cutoff = 0.9)
# aucuns descripteurs ne sont corrélés

placenta1.2 = as.data.frame(placenta1)
placenta1.2$CI_groupe = as.factor(ifelse(placenta1.2$CI <= 0.5, "petitCI", "grandCI"))
```

## Visualisation des données (boxplot)
```{r fig.width = 10}
boxplot(placenta1.2[,c(2:ncol(placenta1.2))])
```

## Visualisation des données (histogramme)
```{r}
hist(placenta1[,"CI"], col = "red")
abline(hist(placenta1[,"CI"]),col="red",lwd=0)
```

## Visualisation des données (plot)
```{r fig.width = 8, fig.height = 5}
placenta.dist <- dist(placenta1.2[,3:ncol(placenta1.2)-1])
placenta.mds <- cmdscale(placenta.dist)
plot(placenta.mds, col = placenta1.2$CI_groupe)
```

Rouge = Petite CI || Noir = Grande CI

# Prédiction
```{r}
placenta1.2$CI_groupe = as.factor(ifelse(placenta1.2$CI <= 0.5, "petitCI", "grandCI"))
petit = as.numeric(placenta1.2$CI_groupe == "petitCI")

data.placenta = data.frame(placenta1.2[,c(2:ncol(placenta1))], petit)
ind.app <- sample(1:nrow(data.placenta), 60)
placenta.app <- data.placenta[ind.app,]
placenta.val <- data.placenta[-ind.app,]
```

## La normalité des deux échantillons
```{r fig.width = 15, fig.height = 6}
par(mfrow = c(1,2))
boxplot(placenta.app[,c(1:10)])
boxplot(placenta.val[,c(1:10)])

formule = as.formula(petit ~ ast_fraglike + ast_fraglike_ext + ast_violation + a_don + a_ICM + BCUT_SLOGP_1 + BCUT_SLOGP_3 + BCUT_SMR_0 + b_1rotN + b_double + chiral_u + density + FCharge + GCUT_PEOE_1 + GCUT_PEOE_2 + GCUT_SLOGP_1 + GCUT_SLOGP_2 + GCUT_SMR_1 + lip_violation + logP.o.w. + opr_leadlike + PEOE_PC. + PEOE_PC..1 + PEOE_RPC. + PEOE_RPC..1 + PEOE_VSA.1 + PEOE_VSA.2 + PEOE_VSA.3 + PEOE_VSA.4 + PEOE_VSA.1.1 + PEOE_VSA.2.1 + PEOE_VSA.3.1 + PEOE_VSA.4.1 + PEOE_VSA.5.1 + PEOE_VSA.6.1 + PEOE_VSA_FHYD + PEOE_VSA_FPNEG + PEOE_VSA_FPPOS + PEOE_VSA_NEG + PEOE_VSA_PNEG + PEOE_VSA_POL + PEOE_VSA_PPOS + reactive + SlogP_VSA0 + SlogP_VSA1 + SlogP_VSA2 + SlogP_VSA3 + SlogP_VSA4 + SlogP_VSA6 + SMR_VSA1 + SMR_VSA2 + SMR_VSA3 + SMR_VSA4 + vsa_acc + vsa_base + vsa_don + vsa_other + vsa_pol + Ms + ARR + nCIR + nAB + nH + nN + nO + nR05 + nR07 + nR08 + TI2 + J + Jhetp + MAXDN + MAXDP + S3K + PW2 + D.Dr05 + D.Dr06 + D.Dr08 + D.Dr09 + D.Dr10 + T.Cl..Cl. + SRW05 + MPC10 + PCR + X0Av + X1Av + ATS7m + MATS3m + MATS4m + MATS5m + MATS1v + MATS2v + MATS3v + MATS8v + MATS3p + MATS4p + GATS1m + GATS2m + GATS3m + GATS8m + GATS3v + GATS8v + GATS3e + GATS5e + GATS7e + GATS8e + GATS1p + GATS3p + JGI1 + JGI3 + JGI5 + JGI7 + JGI8 + JGI9 + JGI10 + JGT + DP20 + J3D + PJI3 + L.Bw + AROM + DISPm + DISPv + DISPe + G.N..N. + G.N..O. + G.N..S. + G.N..Cl. + G.O..O. + G.S..S. + nCs + nCrs + nCrt + nCbH + nCb. + nCconj + nArCOOR + nRCONH2 + nRCONHR + nRCONR2 + nROCON + nArCO + nC..N.N2 + nArNH2 + nArNHR + nRNR2 + nArOH + nOHp + nOHs + nOHt + nRSR + nArX + nBeta.Lactams + nOxolanes + nThiazoles + nHBonds + C.003 + C.007 + C.008 + C.009 + C.011 + C.016 + C.017 + C.018 + C.019 + C.025 + C.028 + C.031 + C.032 + C.033 + C.037 + C.040 + C.041 + C.043 + C.044 + H.048 + H.049 + H.053 + O.056 + O.059 + N.066 + N.067 + N.068 + N.072 + N.074 + Cl.089 + S.107 + S.108 + S.110 + Hy + MLOGP + ALOGP + LAI + GVWAI.50 + Inflammat.80 + Inflammat.50 + Depressant.80 + Psychotic.80 + Hypertens.80 + Hypertens.50 + Hypnotic.80 + Hypnotic.50 + Neoplastic.80 + Neoplastic.50 + Infective.50 + ALOGPS_logP + ALOGPS_logS)

Paramètres = c("Taux bon","Sensibilité", "Specifité", "F1_Score")
```


# Prédiction pour 1 couche = 2 neurones
```{r}
reseau2.app = neuralnet(formule, data = placenta.app, hidden = c(2))
reseau2.val = neuralnet(formule, data = placenta.val, hidden = c(2))

predire2.app = compute(reseau2.app, placenta.app[,1:207], rep = 1)
predire2.val = compute(reseau2.val, placenta.val[,1:207], rep = 1)

prediction.2.app = ifelse(predire2.app$net.result[,1] >= 0.5, 1 ,0)
prediction.2.val = ifelse(predire2.val$net.result[,1] >= 0.5, 1 ,0)

confiance.2.app <- table(prediction.2.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.2.val <- table(prediction.2.val, placenta.val$petit, dnn = c("predit", "observe"))
```

## Prédiction dans l'échantillon d'apprentissage

Prédiction avec une couche de 2 neurones
```{r}
knitr::kable(confiance.2.app)
```

## Les critères (échantillon d'apprentissage)
```{r}
Valeurs.2.app = c(acc(confiance.2.app), sens(confiance.2.app), spec(confiance.2.app), scor(confiance.2.app))
kable(data.frame(Paramètres, Valeurs.2.app))
```

## Prédiction dans l'échantillon de validation

Prédiction avec une couche de 2 neurones
```{r}
knitr::kable(confiance.2.val)
```

## Les critères (échantillon de validation)
```{r}
Valeurs.2.val = c(acc(confiance.2.val), sens(confiance.2.val), spec(confiance.2.val), scor(confiance.2.val))
kable(data.frame(Paramètres, Valeurs.2.val))
```


# Prédiction pour différents nombres de neurones pour 1 couche
```{r}
# Prédiction pour 1 couche = 1 neurone
reseau1.app = neuralnet(formule, data = placenta.app, hidden = c(1))
reseau1.val = neuralnet(formule, data = placenta.val, hidden = c(1))

predire1.app = compute(reseau1.app, placenta.app[,1:207], rep = 1)
predire1.val = compute(reseau1.val, placenta.val[,1:207], rep = 1)

prediction.1.app = ifelse(predire1.app$net.result[,1] >= 0.5, 1 ,0)
prediction.1.val = ifelse(predire1.val$net.result[,1] >= 0.5, 1 ,0)

confiance.1.app <- table(prediction.1.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.1.val <- table(prediction.1.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 3 neurones
reseau3.app = neuralnet(formule, data = placenta.app, hidden = c(3))
reseau3.val = neuralnet(formule, data = placenta.val, hidden = c(3))

predire3.app = compute(reseau3.app, placenta.app[,1:207], rep = 1)
predire3.val = compute(reseau3.val, placenta.val[,1:207], rep = 1)

prediction.3.app = ifelse(predire3.app$net.result[,1] >= 0.5, 1 ,0)
prediction.3.val = ifelse(predire3.val$net.result[,1] >= 0.5, 1 ,0)

confiance.3.app <- table(prediction.3.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.3.val <- table(prediction.3.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 4 neurones

reseau4.app = neuralnet(formule, data = placenta.app, hidden = c(4))
reseau4.val = neuralnet(formule, data = placenta.val, hidden = c(4))

predire4.app = compute(reseau4.app, placenta.app[,1:207], rep = 1)
predire4.val = compute(reseau4.val, placenta.val[,1:207], rep = 1)

prediction.4.app = ifelse(predire4.app$net.result[,1] >= 0.5, 1 ,0)
prediction.4.val = ifelse(predire4.val$net.result[,1] >= 0.5, 1 ,0)

confiance.4.app <- table(prediction.4.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.4.val <- table(prediction.4.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 5 neurones

reseau5.app = neuralnet(formule, data = placenta.app, hidden = c(5))
reseau5.val = neuralnet(formule, data = placenta.val, hidden = c(5))

predire5.app = compute(reseau5.app, placenta.app[,1:207], rep = 1)
predire5.val = compute(reseau5.val, placenta.val[,1:207], rep = 1)

prediction.5.app = ifelse(predire5.app$net.result[,1] >= 0.5, 1 ,0)
prediction.5.val = ifelse(predire5.val$net.result[,1] >= 0.5, 1 ,0)

confiance.5.app <- table(prediction.5.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.5.val <- table(prediction.5.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 6 neurones

reseau6.app = neuralnet(formule, data = placenta.app, hidden = c(6))
reseau6.val = neuralnet(formule, data = placenta.val, hidden = c(6))

predire6.app = compute(reseau6.app, placenta.app[,1:207], rep = 1)
predire6.val = compute(reseau6.val, placenta.val[,1:207], rep = 1)

prediction.6.app = ifelse(predire6.app$net.result[,1] >= 0.5, 1 ,0)
prediction.6.val = ifelse(predire6.val$net.result[,1] >= 0.5, 1 ,0)

confiance.6.app <- table(prediction.6.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.6.val <- table(prediction.6.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 7 neurones

reseau7.app = neuralnet(formule, data = placenta.app, hidden = c(7))
reseau7.val = neuralnet(formule, data = placenta.val, hidden = c(7))

predire7.app = compute(reseau7.app, placenta.app[,1:207], rep = 1)
predire7.val = compute(reseau7.val, placenta.val[,1:207], rep = 1)

prediction.7.app = ifelse(predire7.app$net.result[,1] >= 0.5, 1 ,0)
prediction.7.val = ifelse(predire7.val$net.result[,1] >= 0.5, 1 ,0)

confiance.7.app <- table(prediction.7.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.7.val <- table(prediction.7.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 8 neurones

reseau8.app = neuralnet(formule, data = placenta.app, hidden = c(8))
reseau8.val = neuralnet(formule, data = placenta.val, hidden = c(8))

predire8.app = compute(reseau8.app, placenta.app[,1:207], rep = 1)
predire8.val = compute(reseau8.val, placenta.val[,1:207], rep = 1)

prediction.8.app = ifelse(predire8.app$net.result[,1] >= 0.5, 1 ,0)
prediction.8.val = ifelse(predire8.val$net.result[,1] >= 0.5, 1 ,0)

confiance.8.app <- table(prediction.8.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.8.val <- table(prediction.8.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 9 neurones

reseau9.app = neuralnet(formule, data = placenta.app, hidden = c(9))
reseau9.val = neuralnet(formule, data = placenta.val, hidden = c(9))

predire9.app = compute(reseau9.app, placenta.app[,1:207], rep = 1)
predire9.val = compute(reseau9.val, placenta.val[,1:207], rep = 1)

prediction.9.app = ifelse(predire9.app$net.result[,1] >= 0.5, 1 ,0)
prediction.9.val = ifelse(predire9.val$net.result[,1] >= 0.5, 1 ,0)

confiance.9.app <- table(prediction.9.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.9.val <- table(prediction.9.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 10 neurones

reseau10.app = neuralnet(formule, data = placenta.app, hidden = c(10))
reseau10.val = neuralnet(formule, data = placenta.val, hidden = c(10))

predire10.app = compute(reseau10.app, placenta.app[,1:207], rep = 1)
predire10.val = compute(reseau10.val, placenta.val[,1:207], rep = 1)

prediction.10.app = ifelse(predire10.app$net.result[,1] >= 0.5, 1 ,0)
prediction.10.val = ifelse(predire10.val$net.result[,1] >= 0.5, 1 ,0)

confiance.10.app <- table(prediction.10.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.10.val <- table(prediction.10.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 20 neurones

reseau20.app = neuralnet(formule, data = placenta.app, hidden = c(20))
reseau20.val = neuralnet(formule, data = placenta.val, hidden = c(20))

predire20.app = compute(reseau20.app, placenta.app[,1:207], rep = 1)
predire20.val = compute(reseau20.val, placenta.val[,1:207], rep = 1)

prediction.20.app = ifelse(predire20.app$net.result[,1] >= 0.5, 1 ,0)
prediction.20.val = ifelse(predire20.val$net.result[,1] >= 0.5, 1 ,0)

confiance.20.app <- table(prediction.20.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.20.val <- table(prediction.20.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 30 neurones

reseau30.app = neuralnet(formule, data = placenta.app, hidden = c(30))
reseau30.val = neuralnet(formule, data = placenta.val, hidden = c(30))

predire30.app = compute(reseau30.app, placenta.app[,1:207], rep = 1)
predire30.val = compute(reseau30.val, placenta.val[,1:207], rep = 1)

prediction.30.app = ifelse(predire30.app$net.result[,1] >= 0.5, 1 ,0)
prediction.30.val = ifelse(predire30.val$net.result[,1] >= 0.5, 1 ,0)

confiance.30.app <- table(prediction.30.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.30.val <- table(prediction.30.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 40 neurones

reseau40.app = neuralnet(formule, data = placenta.app, hidden = c(40))
reseau40.val = neuralnet(formule, data = placenta.val, hidden = c(40))

predire40.app = compute(reseau40.app, placenta.app[,1:207], rep = 1)
predire40.val = compute(reseau40.val, placenta.val[,1:207], rep = 1)

prediction.40.app = ifelse(predire40.app$net.result[,1] >= 0.5, 1 ,0)
prediction.40.val = ifelse(predire40.val$net.result[,1] >= 0.5, 1 ,0)

confiance.40.app <- table(prediction.40.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.40.val <- table(prediction.40.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 50 neurones

reseau50.app = neuralnet(formule, data = placenta.app, hidden = c(50))
reseau50.val = neuralnet(formule, data = placenta.val, hidden = c(50))

predire50.app = compute(reseau50.app, placenta.app[,1:207], rep = 1)
predire50.val = compute(reseau50.val, placenta.val[,1:207], rep = 1)

prediction.50.app = ifelse(predire50.app$net.result[,1] >= 0.5, 1 ,0)
prediction.50.val = ifelse(predire50.val$net.result[,1] >= 0.5, 1 ,0)

confiance.50.app <- table(prediction.50.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.50.val <- table(prediction.50.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 100 neurones

reseau100.app = neuralnet(formule, data = placenta.app, hidden = c(100))
reseau100.val = neuralnet(formule, data = placenta.val, hidden = c(100))

predire100.app = compute(reseau100.app, placenta.app[,1:207], rep = 1)
predire100.val = compute(reseau100.val, placenta.val[,1:207], rep = 1)

prediction.100.app = ifelse(predire100.app$net.result[,1] >= 0.5, 1 ,0)
prediction.100.val = ifelse(predire100.val$net.result[,1] >= 0.5, 1 ,0)

confiance.100.app <- table(prediction.100.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.100.val <- table(prediction.100.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 150 neurones

reseau150.app = neuralnet(formule, data = placenta.app, hidden = c(150))
reseau150.val = neuralnet(formule, data = placenta.val, hidden = c(150))

predire150.app = compute(reseau150.app, placenta.app[,1:207], rep = 1)
predire150.val = compute(reseau150.val, placenta.val[,1:207], rep = 1)

prediction.150.app = ifelse(predire150.app$net.result[,1] >= 0.5, 1 ,0)
prediction.150.val = ifelse(predire150.val$net.result[,1] >= 0.5, 1 ,0)

confiance.150.app <- table(prediction.150.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.150.val <- table(prediction.150.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 1 couche = 207 neurones

reseau207.app = neuralnet(formule, data = placenta.app, hidden = c(207))
reseau207.val = neuralnet(formule, data = placenta.val, hidden = c(207))

predire207.app = compute(reseau207.app, placenta.app[,1:207], rep = 1)
predire207.val = compute(reseau207.val, placenta.val[,1:207], rep = 1)

prediction.207.app = ifelse(predire207.app$net.result[,1] >= 0.5, 1 ,0)
prediction.207.val = ifelse(predire207.val$net.result[,1] >= 0.5, 1 ,0)

confiance.207.app <- table(prediction.207.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.207.val <- table(prediction.207.val, placenta.val$petit, dnn = c("predit", "observe"))
```

## Tableau d'accuracy
```{r}
couches.neurones = c("1 couche 1 neurone", "1 couche 2 neurones", "1 couche 3 neurones", "1 couche 4 neurones", "1 couche 5 neurones", "1 couche 6 neurones", "1 couche 7 neurones", "1 couche 8 neurones", "1 couche 9 neurones", "1 couche 10 neurones", "1 couche 20 neurones", "1 couche 30 neurones")
apprentissage = c(acc(confiance.1.app), acc(confiance.2.app), acc(confiance.3.app), acc(confiance.4.app), acc(confiance.5.app), acc(confiance.6.app), acc(confiance.7.app), acc(confiance.8.app), acc(confiance.9.app), acc(confiance.10.app), acc(confiance.20.app), acc(confiance.30.app))
validation = c(acc(confiance.1.val), acc(confiance.2.val), acc(confiance.3.val), acc(confiance.4.val), acc(confiance.5.val), acc(confiance.6.val), acc(confiance.7.val), acc(confiance.8.val), acc(confiance.9.val), acc(confiance.10.val), acc(confiance.20.val), acc(confiance.30.val))
kable(data.frame(couches.neurones, apprentissage, validation))
```

## Courbe ROC (1)
```{r}
seuil <- seq(0, 1, length.out = 100)
clairance.app <- placenta.app$petit
clairance.val <- placenta.val$petit

vsens.app <- data.frame(vsens2 = rep(NA, 100), vsens3 = c(NA), vsens4 = c(NA), vsens5 = c(NA), vsens6 = c(NA), vsens7 = c(NA), vsens8 = c(NA), vsens9 = c(NA), vsens10 = c(NA), vsens20 = c(NA), vsens30 = c(NA), vsens40 = c(NA), vsens50 = c(NA), vsens100 = c(NA), vsens150 = c(NA), vsens207 = c(NA))

vsens.val <- data.frame(vsens2 = rep(NA, 100), vsens3 = c(NA), vsens4 = c(NA), vsens5 = c(NA), vsens6 = c(NA), vsens7 = c(NA), vsens8 = c(NA), vsens9 = c(NA), vsens10 = c(NA), vsens20 = c(NA), vsens30 = c(NA), vsens40 = c(NA), vsens50 = c(NA), vsens100 = c(NA), vsens150 = c(NA), vsens207 = c(NA))

vspe.app <- data.frame(vspe2 = rep(NA, 100), vspe3 = c(NA), vspe4 = c(NA), vspe5 = c(NA), vspe6 = c(NA), vspe7 = c(NA), vspe8 = c(NA), vspe9 = c(NA), vspe10 = c(NA), vspe20 = c(NA), vspe30 = c(NA), vspe40 = c(NA), vspe50 = c(NA), vspe100 = c(NA), vspe150 = c(NA), vspe207 = c(NA))

vspe.val <- data.frame(vspe2 = rep(NA, 100), vspe3 = c(NA), vspe4 = c(NA), vspe5 = c(NA), vspe6 = c(NA), vspe7 = c(NA), vspe8 = c(NA), vspe9 = c(NA), vspe10 = c(NA), vspe20 = c(NA), vspe30 = c(NA), vspe40 = c(NA), vspe50 = c(NA), vspe100 = c(NA), vspe150 = c(NA), vspe207 = c(NA))

roc_courbe.sens = function (predire.ech, vsens.ech, clairance.ech) {
  for (i in 1:100) {
    clairance.pred <- predire.ech >= seuil[i]
    vsens.ech[i] <- sens(table(clairance.pred, clairance.ech))
  }
  return(vsens.ech)
}
roc_courbe.spe = function (predire.ech, vspe.ech, clairance.ech) {
  for (i in 1:100) {
    clairance.pred <- predire.ech >= seuil[i]
    vspe.ech[i] <- spec(table(clairance.pred, clairance.ech))
  }
  return(vspe.ech)
}

```

```{r fig.width = 10, fig.height = 7}
specificite <- seq(0.01, 1, 0.01)
par(mfrow = c(2,3))
vsens.app2 = roc_courbe.sens(predire.ech = predire2.app$net.result, vsens.ech = vsens.app$vsens2, clairance.ech = clairance.app)
vspe.app2 = roc_courbe.spe(predire.ech = predire2.app$net.result, vspe.ech = vspe.app$vspe2, clairance.ech = clairance.app)
vsens.val2 = roc_courbe.sens(predire.ech = predire2.val$net.result, vsens.ech = vsens.val$vsens2, clairance.ech = clairance.val)
vspe.val2 = roc_courbe.spe(predire.ech = predire2.val$net.result, vspe.ech = vspe.val$vspe2, clairance.ech = clairance.val)

#specificité <- data.frame(vspe.app2, vspe.val2)
sensibilité <- data.frame(vsens.app2, vsens.val2)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1, main = "1 couche 2 neurones")

#matplot(1-vspe.app2,vsens.app2,col=rainbow(2),type="l",lty=1)
#matplot(1-vspe.val2,vsens.val2,col=rainbow(2),type="l",lty=1)

# rouge = app et bleu = val

vsens.app3 = roc_courbe.sens(predire.ech = predire3.app$net.result[,1], vsens.ech = vsens.app$vsens3, clairance.ech = clairance.app)
vsens.val3 = roc_courbe.sens(predire.ech = predire3.val$net.result[,1], vsens.ech = vsens.val$vsens3, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app3, vsens.val3)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "1 couche 3 neurones")
#####

vsens.app4 = roc_courbe.sens(predire.ech = predire4.app$net.result[,1], vsens.ech = vsens.app$vsens4, clairance.ech = clairance.app)
vsens.val4 = roc_courbe.sens(predire.ech = predire4.val$net.result[,1], vsens.ech = vsens.val$vsens4, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app4, vsens.val4)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "1 couche 4 neurones")
#####

vsens.app5 = roc_courbe.sens(predire.ech = predire5.app$net.result[,1], vsens.ech = vsens.app$vsens5, clairance.ech = clairance.app)
vsens.val5 = roc_courbe.sens(predire.ech = predire5.val$net.result[,1], vsens.ech = vsens.val$vsens5, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app5, vsens.val5)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "1 couche 5 neurones")
#####

vsens.app6 = roc_courbe.sens(predire.ech = predire6.app$net.result[,1], vsens.ech = vsens.app$vsens6, clairance.ech = clairance.app)
vsens.val6 = roc_courbe.sens(predire.ech = predire6.val$net.result[,1], vsens.ech = vsens.val$vsens6, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app6, vsens.val6)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "1 couche 6 neurones")
#####

vsens.app7 = roc_courbe.sens(predire.ech = predire7.app$net.result[,1], vsens.ech = vsens.app$vsens7, clairance.ech = clairance.app)
vsens.val7 = roc_courbe.sens(predire.ech = predire7.val$net.result[,1], vsens.ech = vsens.val$vsens7, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app7, vsens.val7)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "1 couche 7 neurones")
```

## Courbe ROC (2)
```{r fig.width = 10, fig.height = 7}
par(mfrow = c(2,3))

vsens.app8 = roc_courbe.sens(predire.ech = predire8.app$net.result[,1], vsens.ech = vsens.app$vsens8, clairance.ech = clairance.app)
vsens.val8 = roc_courbe.sens(predire.ech = predire8.val$net.result[,1], vsens.ech = vsens.val$vsens8, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app8, vsens.val8)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "1 couche 8 neurones")
######

vsens.app9 = roc_courbe.sens(predire.ech = predire9.app$net.result[,1], vsens.ech = vsens.app$vsens9, clairance.ech = clairance.app)
vsens.val9 = roc_courbe.sens(predire.ech = predire9.val$net.result[,1], vsens.ech = vsens.val$vsens9, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app9, vsens.val9)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "1 couche 9 neurones")
#####

vsens.app10 = roc_courbe.sens(predire.ech = predire10.app$net.result[,1], vsens.ech = vsens.app$vsens10, clairance.ech = clairance.app)
vsens.val10 = roc_courbe.sens(predire.ech = predire10.val$net.result[,1], vsens.ech = vsens.val$vsens10, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app10, vsens.val10)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "1 couche 10 neurones")
#####

vsens.app20 = roc_courbe.sens(predire.ech = predire20.app$net.result[,1], vsens.ech = vsens.app$vsens20, clairance.ech = clairance.app)
vsens.val20 = roc_courbe.sens(predire.ech = predire20.val$net.result[,1], vsens.ech = vsens.val$vsens20, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app20, vsens.val20)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "1 couche 20 neurones")
#####

vsens.app30 = roc_courbe.sens(predire.ech = predire30.app$net.result[,1], vsens.ech = vsens.app$vsens30, clairance.ech = clairance.app)
vsens.val30 = roc_courbe.sens(predire.ech = predire30.val$net.result[,1], vsens.ech = vsens.val$vsens30, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app30, vsens.val30)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "1 couche 30 neurones")
#####

vsens.app40 = roc_courbe.sens(predire.ech = predire40.app$net.result[,1], vsens.ech = vsens.app$vsens40, clairance.ech = clairance.app)
vsens.val40 = roc_courbe.sens(predire.ech = predire40.val$net.result[,1], vsens.ech = vsens.val$vsens40, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app40, vsens.val40)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "1 couche 40 neurones")
```


# Prédiction pour différents 2n/n de neurones pour 2 couches
```{r}
# Prédiction pour 2 couches = 2.1 neurones

reseau2.1.app = neuralnet(formule, data = placenta.app, hidden = c(2,1))
reseau2.1.val = neuralnet(formule, data = placenta.val, hidden = c(2,1))

predire2.1.app = compute(reseau2.1.app, placenta.app[,1:207], rep = 1)
predire2.1.val = compute(reseau2.1.val, placenta.val[,1:207], rep = 1)

prediction.2.1.app = ifelse(predire2.1.app$net.result[,1] >= 0.5, 1 ,0)
prediction.2.1.val = ifelse(predire2.1.val$net.result[,1] >= 0.5, 1 ,0)

confiance.2.1.app <- table(prediction.2.1.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.2.1.val <- table(prediction.2.1.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 2 couches = 4.2 neurones

reseau4.2.app = neuralnet(formule, data = placenta.app, hidden = c(4,2))
reseau4.2.val = neuralnet(formule, data = placenta.val, hidden = c(4,2))

predire4.2.app = compute(reseau4.2.app, placenta.app[,1:207], rep = 1)
predire4.2.val = compute(reseau4.2.val, placenta.val[,1:207], rep = 1)

prediction.4.2.app = ifelse(predire4.2.app$net.result[,1] >= 0.5, 1 ,0)
prediction.4.2.val = ifelse(predire4.2.val$net.result[,1] >= 0.5, 1 ,0)

confiance.4.2.app <- table(prediction.4.2.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.4.2.val <- table(prediction.4.2.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 2 couches = 6.3 neurones

reseau6.3.app = neuralnet(formule, data = placenta.app, hidden = c(6,3))
reseau6.3.val = neuralnet(formule, data = placenta.val, hidden = c(6,3))

predire6.3.app = compute(reseau6.3.app, placenta.app[,1:207], rep = 1)
predire6.3.val = compute(reseau6.3.val, placenta.val[,1:207], rep = 1)

prediction.6.3.app = ifelse(predire6.3.app$net.result[,1] >= 0.5, 1 ,0)
prediction.6.3.val = ifelse(predire6.3.val$net.result[,1] >= 0.5, 1 ,0)

confiance.6.3.app <- table(prediction.6.3.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.6.3.val <- table(prediction.6.3.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 2 couches = 8.4 neurones

reseau8.4.app = neuralnet(formule, data = placenta.app, hidden = c(8,4))
reseau8.4.val = neuralnet(formule, data = placenta.val, hidden = c(8,4))

predire8.4.app = compute(reseau8.4.app, placenta.app[,1:207], rep = 1)
predire8.4.val = compute(reseau8.4.val, placenta.val[,1:207], rep = 1)

prediction.8.4.app = ifelse(predire8.4.app$net.result[,1] >= 0.5, 1 ,0)
prediction.8.4.val = ifelse(predire8.4.val$net.result[,1] >= 0.5, 1 ,0)

confiance.8.4.app <- table(prediction.8.4.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.8.4.val <- table(prediction.8.4.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 2 couches = 10.5 neurones

reseau10.5.app = neuralnet(formule, data = placenta.app, hidden = c(10,5))
reseau10.5.val = neuralnet(formule, data = placenta.val, hidden = c(10,5))

predire10.5.app = compute(reseau10.5.app, placenta.app[,1:207], rep = 1)
predire10.5.val = compute(reseau10.5.val, placenta.val[,1:207], rep = 1)

prediction.10.5.app = ifelse(predire10.5.app$net.result[,1] >= 0.5, 1 ,0)
prediction.10.5.val = ifelse(predire10.5.val$net.result[,1] >= 0.5, 1 ,0)

confiance.10.5.app <- table(prediction.10.5.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.10.5.val <- table(prediction.10.5.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 2 couches = 20.10 neurones

reseau20.10.app = neuralnet(formule, data = placenta.app, hidden = c(20,10))
reseau20.10.val = neuralnet(formule, data = placenta.val, hidden = c(20,10))

predire20.10.app = compute(reseau20.10.app, placenta.app[,1:207], rep = 1)
predire20.10.val = compute(reseau20.10.val, placenta.val[,1:207], rep = 1)

prediction.20.10.app = ifelse(predire20.10.app$net.result[,1] >= 0.5, 1 ,0)
prediction.20.10.val = ifelse(predire20.10.val$net.result[,1] >= 0.5, 1 ,0)

confiance.20.10.app <- table(prediction.20.10.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.20.10.val <- table(prediction.20.10.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 2 couches = 100.50 neurones

reseau100.50.app = neuralnet(formule, data = placenta.app, hidden = c(100,50))
reseau100.50.val = neuralnet(formule, data = placenta.val, hidden = c(100,50))

predire100.50.app = compute(reseau100.50.app, placenta.app[,1:207], rep = 1)
predire100.50.val = compute(reseau100.50.val, placenta.val[,1:207], rep = 1)

prediction.100.50.app = ifelse(predire100.50.app$net.result[,1] >= 0.5, 1 ,0)
prediction.100.50.val = ifelse(predire100.50.val$net.result[,1] >= 0.5, 1 ,0)

confiance.100.50.app <- table(prediction.100.50.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.100.50.val <- table(prediction.100.50.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 2 couches = 200.100 neurones

reseau200.100.app = neuralnet(formule, data = placenta.app, hidden = c(200,100))
reseau200.100.val = neuralnet(formule, data = placenta.val, hidden = c(200,100))

predire200.100.app = compute(reseau200.100.app, placenta.app[,1:207], rep = 1)
predire200.100.val = compute(reseau200.100.val, placenta.val[,1:207], rep = 1)

prediction.200.100.app = ifelse(predire200.100.app$net.result[,1] >= 0.5, 1 ,0)
prediction.200.100.val = ifelse(predire200.100.val$net.result[,1] >= 0.5, 1 ,0)

confiance.200.100.app <- table(prediction.200.100.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.200.100.val <- table(prediction.200.100.val, placenta.val$petit, dnn = c("predit", "observe"))
```

## Tableau d'accuracy
```{r}
couches.neurones = c("2 couches 2 neurones et 1 neurone", "2 couches 4 neurones et 2 neurones", "2 couches 6 neurones et 3 neurones", "2 couches 8 neurones et 4 neurones", "2 couches 10 neurones et 5 neurones", "2 couches 20 neurones et 10 neurones", "2 couches 100 neurones et 50 neurones", "2 couches 200 neurones et 100 neurones")
apprentissage = c(acc(confiance.2.1.app), acc(confiance.4.2.app), acc(confiance.6.3.app), acc(confiance.8.4.app), acc(confiance.10.5.app), acc(confiance.20.10.app), acc(confiance.100.50.app), acc(confiance.200.100.app))
validation = c(acc(confiance.2.1.val), acc(confiance.4.2.val), acc(confiance.6.3.val), acc(confiance.8.4.val), acc(confiance.10.5.val), acc(confiance.20.10.val), acc(confiance.100.50.val), acc(confiance.200.100.val))
kable(data.frame(couches.neurones, apprentissage, validation))
```

## Courbe ROC
```{r  fig.width = 10, fig.height = 7}
par(mfrow = c(2,4))
vsens.app <- data.frame(vsens2.1 = rep(NA, 100), vsens4.2 = c(NA), vsens6.3 = c(NA), vsens8.4 = c(NA), vsens10.5 = c(NA), vsens20.10 = c(NA), vsens100.50 = c(NA), vsens200.100 = c(NA))
vsens.val <- data.frame(vsens2.1 = rep(NA, 100), vsens4.2 = c(NA), vsens6.3 = c(NA), vsens8.4 = c(NA), vsens10.5 = c(NA), vsens20.10 = c(NA), vsens100.50 = c(NA), vsens200.100 = c(NA))

vsens.app2.1 = roc_courbe.sens(predire.ech = predire2.1.app$net.result[,1], vsens.ech = vsens.app$vsens2.1, clairance.ech = clairance.app)
vsens.val2.1 = roc_courbe.sens(predire.ech = predire2.1.val$net.result[,1], vsens.ech = vsens.val$vsens2.1, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app2.1, vsens.val2.1)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 2.1 neurones")
#####

vsens.app4.2 = roc_courbe.sens(predire.ech = predire4.2.app$net.result[,1], vsens.ech = vsens.app$vsens4.2, clairance.ech = clairance.app)
vsens.val4.2 = roc_courbe.sens(predire.ech = predire4.2.val$net.result[,1], vsens.ech = vsens.val$vsens4.2, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app4.2, vsens.val4.2)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 4.2 neurones")
#####

vsens.app6.3 = roc_courbe.sens(predire.ech = predire6.3.app$net.result[,1], vsens.ech = vsens.app$vsens6.3, clairance.ech = clairance.app)
vsens.val6.3 = roc_courbe.sens(predire.ech = predire6.3.val$net.result[,1], vsens.ech = vsens.val$vsens6.3, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app6.3, vsens.val6.3)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 6.3 neurones")
#####

vsens.app8.4 = roc_courbe.sens(predire.ech = predire8.4.app$net.result[,1], vsens.ech = vsens.app$vsens8.4, clairance.ech = clairance.app)
vsens.val8.4 = roc_courbe.sens(predire.ech = predire8.4.val$net.result[,1], vsens.ech = vsens.val$vsens8.4, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app8.4, vsens.val8.4)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 8.4 neurones")
#####

vsens.app10.5 = roc_courbe.sens(predire.ech = predire10.5.app$net.result[,1], vsens.ech = vsens.app$vsens10.5, clairance.ech = clairance.app)
vsens.val10.5 = roc_courbe.sens(predire.ech = predire10.5.val$net.result[,1], vsens.ech = vsens.val$vsens10.5, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app10.5, vsens.val10.5)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 10.5 neurones")
#####

vsens.app20.10 = roc_courbe.sens(predire.ech = predire20.10.app$net.result[,1], vsens.ech = vsens.app$vsens20.10, clairance.ech = clairance.app)
vsens.val20.10 = roc_courbe.sens(predire.ech = predire20.10.val$net.result[,1], vsens.ech = vsens.val$vsens20.10, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app20.10, vsens.val20.10)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 20.10 neurones")
#####

vsens.app100.50 = roc_courbe.sens(predire.ech = predire100.50.app$net.result[,1], vsens.ech = vsens.app$vsens100.50, clairance.ech = clairance.app)
vsens.val100.50 = roc_courbe.sens(predire.ech = predire100.50.val$net.result[,1], vsens.ech = vsens.val$vsens100.50, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app100.50, vsens.val100.50)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 100.50 neurones")
#####

vsens.app200.100 = roc_courbe.sens(predire.ech = predire200.100.app$net.result[,1], vsens.ech = vsens.app$vsens200.100, clairance.ech = clairance.app)
vsens.val200.100 = roc_courbe.sens(predire.ech = predire200.100.val$net.result[,1], vsens.ech = vsens.val$vsens200.100, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app200.100, vsens.val200.100)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 200.100 neurones")
#####

```


# Prédiction pour différents n/2n de neurones pour 2 couches
```{r}
# Prédiction pour 2 couches = 1.2 neurones

reseau1.2.app = neuralnet(formule, data = placenta.app, hidden = c(1,2))
reseau1.2.val = neuralnet(formule, data = placenta.val, hidden = c(1,2))

predire1.2.app = compute(reseau1.2.app, placenta.app[,1:207], rep = 1)
predire1.2.val = compute(reseau1.2.val, placenta.val[,1:207], rep = 1)

prediction.1.2.app = ifelse(predire1.2.app$net.result[,1] >= 0.5, 1 ,0)
prediction.1.2.val = ifelse(predire1.2.val$net.result[,1] >= 0.5, 1 ,0)

confiance.1.2.app <- table(prediction.1.2.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.1.2.val <- table(prediction.1.2.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 2 couches = 2.4 neurones

reseau2.4.app = neuralnet(formule, data = placenta.app, hidden = c(2,4))
reseau2.4.val = neuralnet(formule, data = placenta.val, hidden = c(2,4))

predire2.4.app = compute(reseau2.4.app, placenta.app[,1:207], rep = 1)
predire2.4.val = compute(reseau2.4.val, placenta.val[,1:207], rep = 1)

prediction.2.4.app = ifelse(predire2.4.app$net.result[,1] >= 0.5, 1 ,0)
prediction.2.4.val = ifelse(predire2.4.val$net.result[,1] >= 0.5, 1 ,0)

confiance.2.4.app <- table(prediction.2.4.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.2.4.val <- table(prediction.2.4.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 2 couches = 3.6 neurones

reseau3.6.app = neuralnet(formule, data = placenta.app, hidden = c(3,6))
reseau3.6.val = neuralnet(formule, data = placenta.val, hidden = c(3,6))

predire3.6.app = compute(reseau3.6.app, placenta.app[,1:207], rep = 1)
predire3.6.val = compute(reseau3.6.val, placenta.val[,1:207], rep = 1)

prediction.3.6.app = ifelse(predire3.6.app$net.result[,1] >= 0.5, 1 ,0)
prediction.3.6.val = ifelse(predire3.6.val$net.result[,1] >= 0.5, 1 ,0)

confiance.3.6.app <- table(prediction.3.6.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.3.6.val <- table(prediction.3.6.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 2 couches = 4.8 neurones

reseau4.8.app = neuralnet(formule, data = placenta.app, hidden = c(4,8))
reseau4.8.val = neuralnet(formule, data = placenta.val, hidden = c(4,8))

predire4.8.app = compute(reseau4.8.app, placenta.app[,1:207], rep = 1)
predire4.8.val = compute(reseau4.8.val, placenta.val[,1:207], rep = 1)

prediction.4.8.app = ifelse(predire4.8.app$net.result[,1] >= 0.5, 1 ,0)
prediction.4.8.val = ifelse(predire4.8.val$net.result[,1] >= 0.5, 1 ,0)

confiance.4.8.app <- table(prediction.4.8.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.4.8.val <- table(prediction.4.8.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 2 couches = 5.10 neurones

reseau5.10.app = neuralnet(formule, data = placenta.app, hidden = c(5,10))
reseau5.10.val = neuralnet(formule, data = placenta.val, hidden = c(5,10))

predire5.10.app = compute(reseau5.10.app, placenta.app[,1:207], rep = 1)
predire5.10.val = compute(reseau5.10.val, placenta.val[,1:207], rep = 1)

prediction.5.10.app = ifelse(predire5.10.app$net.result[,1] >= 0.5, 1 ,0)
prediction.5.10.val = ifelse(predire5.10.val$net.result[,1] >= 0.5, 1 ,0)

confiance.5.10.app <- table(prediction.5.10.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.5.10.val <- table(prediction.5.10.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 2 couches = 10.20 neurones

reseau10.20.app = neuralnet(formule, data = placenta.app, hidden = c(10,20))
reseau10.20.val = neuralnet(formule, data = placenta.val, hidden = c(10,20))

predire10.20.app = compute(reseau10.20.app, placenta.app[,1:207], rep = 1)
predire10.20.val = compute(reseau10.20.val, placenta.val[,1:207], rep = 1)

prediction.10.20.app = ifelse(predire10.20.app$net.result[,1] >= 0.5, 1 ,0)
prediction.10.20.val = ifelse(predire10.20.val$net.result[,1] >= 0.5, 1 ,0)

confiance.10.20.app <- table(prediction.10.20.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.10.20.val <- table(prediction.10.20.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 2 couches = 50.100 neurones

reseau50.100.app = neuralnet(formule, data = placenta.app, hidden = c(50,100))
reseau50.100.val = neuralnet(formule, data = placenta.val, hidden = c(50,100))

predire50.100.app = compute(reseau50.100.app, placenta.app[,1:207], rep = 1)
predire50.100.val = compute(reseau50.100.val, placenta.val[,1:207], rep = 1)

prediction.50.100.app = ifelse(predire50.100.app$net.result[,1] >= 0.5, 1 ,0)
prediction.50.100.val = ifelse(predire50.100.val$net.result[,1] >= 0.5, 1 ,0)

confiance.50.100.app <- table(prediction.50.100.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.50.100.val <- table(prediction.50.100.val, placenta.val$petit, dnn = c("predit", "observe"))

# Prédiction pour 2 couches = 100.200 neurones

reseau100.200.app = neuralnet(formule, data = placenta.app, hidden = c(100,200))
reseau100.200.val = neuralnet(formule, data = placenta.val, hidden = c(100,200))

predire100.200.app = compute(reseau100.200.app, placenta.app[,1:207], rep = 1)
predire100.200.val = compute(reseau100.200.val, placenta.val[,1:207], rep = 1)

prediction.100.200.app = ifelse(predire100.200.app$net.result[,1] >= 0.5, 1 ,0)
prediction.100.200.val = ifelse(predire100.200.val$net.result[,1] >= 0.5, 1 ,0)

confiance.100.200.app <- table(prediction.100.200.app, placenta.app$petit, dnn = c("predit", "observe"))
confiance.100.200.val <- table(prediction.100.200.val, placenta.val$petit, dnn = c("predit", "observe"))
```

## Tableau d'accuracy
```{r}
couches.neurones = c("2 couches 1 neurone et 2 neurones", "2 couches 2 neurones et 4 neurones", "2 couches 3 neurones et 6 neurones", "2 couches 4 neurones et 8 neurones", "2 couches 5 neurones et 10 neurones", "2 couches 10 neurones et 20 neurones", "2 couches 50 neurones et 100 neurones", "2 couches 100 neurones et 200 neurones")
apprentissage = c(acc(confiance.1.2.app), acc(confiance.2.4.app), acc(confiance.3.6.app), acc(confiance.4.8.app), acc(confiance.5.10.app), acc(confiance.10.20.app), acc(confiance.50.100.app), acc(confiance.100.200.app))
validation = c(acc(confiance.1.2.val), acc(confiance.2.4.val), acc(confiance.3.6.val), acc(confiance.4.8.val), acc(confiance.5.10.val), acc(confiance.10.20.val), acc(confiance.50.100.val), acc(confiance.100.200.val))
kable(data.frame(couches.neurones, apprentissage, validation))
```

## Courbe ROC
```{r  fig.width = 10, fig.height = 7}
par(mfrow = c(2,4))
vsens.val <- data.frame(vsens1.2 = rep(NA, 100), vsens2.4 = c(NA), vsens3.6 = c(NA), vsens4.8 = c(NA), vsens5.10 = c(NA), vsens10.20 = c(NA), vsens50.100 = c(NA), vsens100.200 = c(NA))

vsens.app1.2 = roc_courbe.sens(predire.ech = predire1.2.app$net.result[,1], vsens.ech = vsens.app$vsens1.2, clairance.ech = clairance.app)
vsens.val1.2 = roc_courbe.sens(predire.ech = predire1.2.val$net.result[,1], vsens.ech = vsens.val$vsens1.2, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app1.2, vsens.val1.2)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 1.2 neurones")
#####

vsens.app2.4 = roc_courbe.sens(predire.ech = predire2.4.app$net.result[,1], vsens.ech = vsens.app$vsens2.4, clairance.ech = clairance.app)
vsens.val2.4 = roc_courbe.sens(predire.ech = predire2.4.val$net.result[,1], vsens.ech = vsens.val$vsens2.4, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app2.4, vsens.val2.4)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 2.4 neurones")
#####

vsens.app3.6 = roc_courbe.sens(predire.ech = predire3.6.app$net.result[,1], vsens.ech = vsens.app$vsens3.6, clairance.ech = clairance.app)
vsens.val3.6 = roc_courbe.sens(predire.ech = predire3.6.val$net.result[,1], vsens.ech = vsens.val$vsens3.6, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app3.6, vsens.val3.6)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 3.6 neurones")
#####

vsens.app4.8 = roc_courbe.sens(predire.ech = predire4.8.app$net.result[,1], vsens.ech = vsens.app$vsens4.8, clairance.ech = clairance.app)
vsens.val4.8 = roc_courbe.sens(predire.ech = predire4.8.val$net.result[,1], vsens.ech = vsens.val$vsens4.8, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app4.8, vsens.val4.8)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 4.8 neurones")
#####

vsens.app5.10 = roc_courbe.sens(predire.ech = predire5.10.app$net.result[,1], vsens.ech = vsens.app$vsens5.10, clairance.ech = clairance.app)
vsens.val5.10 = roc_courbe.sens(predire.ech = predire5.10.val$net.result[,1], vsens.ech = vsens.val$vsens5.10, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app5.10, vsens.val5.10)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 5.10 neurones")
#####

vsens.app10.20 = roc_courbe.sens(predire.ech = predire10.20.app$net.result[,1], vsens.ech = vsens.app$vsens10.20, clairance.ech = clairance.app)
vsens.val10.20 = roc_courbe.sens(predire.ech = predire10.20.val$net.result[,1], vsens.ech = vsens.val$vsens10.20, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app10.20, vsens.val10.20)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 10.20 neurones")
#####

vsens.app50.100 = roc_courbe.sens(predire.ech = predire50.100.app$net.result[,1], vsens.ech = vsens.app$vsens50.100, clairance.ech = clairance.app)
vsens.val50.100 = roc_courbe.sens(predire.ech = predire50.100.val$net.result[,1], vsens.ech = vsens.val$vsens50.100, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app50.100, vsens.val50.100)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 50.100 neurones")
#####

vsens.app100.200 = roc_courbe.sens(predire.ech = predire100.200.app$net.result[,1], vsens.ech = vsens.app$vsens100.200, clairance.ech = clairance.app)
vsens.val100.200 = roc_courbe.sens(predire.ech = predire100.200.val$net.result[,1], vsens.ech = vsens.val$vsens100.200, clairance.ech = clairance.val)
sensibilité <- data.frame(vsens.app100.200, vsens.val100.200)
matplot(1-specificite,sensibilité,col=rainbow(2),type="l",lty=1,  main = "2 couches 100.200 neurones")
#####

```

