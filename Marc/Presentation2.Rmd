---
title: "Stage - Essaie 2"
author: "Marc XU"
date: "8 février 2019"
output:
  revealjs::revealjs_presentation:
    center: yes
    highlight: kate
    theme: league
    transition: zoom
  ioslides_presentation:
    highlight: kate
---
# Neuron Network {data-background="neurone.jpg"}

## Neuron Network 
Neuron Network est une modélisation de la stimulation des neurones sur machine.

Elle est réalisée des outils statistiques.

Durant la réalisation du projet, nous avions besoin de différents packages  
  - neuralnet :  (install.packages(neuralnet))  
  - caret;  
  - nnet;  
  - clues

## Construire un réseau de neurone avec R

Nous allons reproduire un réseau de neurone avec les données d'iris. 

```{r message=FALSE}
library(neuralnet)
library(nnet)
library(mclust)
library(caret)
```

## Trainset & Testset

```{r, echo=FALSE}
set.seed(25)

iris$setosa = iris$Species == "setosa"
iris$virginica = iris$Species == "virginica"
iris$versicolor = iris$Species == "versicolor"

ind <- sample(2, nrow(iris), replace = T, prob = c(0.7, 0.3))

trainset = iris[ind == 1, ]
testset = iris[ind == 2, ]
```
Trainset
```{r, echo=FALSE}
table(trainset$Species)
```
Testset
```{r, echo=FALSE}
table(testset$Species)
```

Dans trainset : 70% des individus choisis aléatoirement dans l'échantillon.  
Dans testset : 30% des individus choisis aléatoirement dans l'échantillon. 

## Crée le réseau de neurones

Créer le réseau de neurone utilisant la fonction "neuralnet" avec les 3 colonnes dans chaque couche
```{r, echo=FALSE}
set.seed(333)
forme = setosa + versicolor + virginica ~ Sepal.Length + Sepal.Width + Petal.Length + Petal.Width
#forme = Espece ~ Sepal.Length + Sepal.Width + Petal.Length + Petal.Width

network = neuralnet(forme, data=trainset, hidden= c(1,2))
informations = network$result.matrix
informations <- as.data.frame(informations)

network2 = neuralnet(forme, data = testset, hidden=1)
informations2 = network2$result.matrix
informations2 <- as.data.frame(informations2)
```

L'argument "hidden" spécifie le nombre de neurones cachés par couche.

## Plot
```{r, echo=FALSE}
plot(network)
plot(network2)
```

## Prediction (1)

```{r, echo=FALSE}
output1 <- compute(network, trainset[, -c(5:9)])
moy_output1 <- apply(output1$net.result, 2, mean)
moy_col <- apply(output1$neurons[[1]], 2, mean)
moy_col <- stack(moy_col)

output2 <- compute(network, testset[, -c(5:9)])
moy_output2 <- apply(output2$net.result, 2, mean)
moy_col2 <- apply(output2$neurons[[1]], 2, mean)
moy_col2 <- stack(moy_col2)

head(output1$net.result, 3)
```

## Prediction (2)
```{r, echo=FALSE}
in_general1 <- informations[4,1] + (informations[5,1]*moy_col[2,1]) + (informations[6,1]*moy_col[3,1]) + (informations[7,1]*moy_col[4,1]) + (informations[8,1]*moy_col[5,1])
out_general1 <- 1/(1+exp(-in_general1))
out_general1

in_general2 <- informations2[4,1] + (informations2[5,1]*moy_col2[2,1]) + (informations2[6,1]*moy_col2[3,1]) + (informations2[7,1]*moy_col2[4,1]) + (informations2[8,1]*moy_col2[5,1])
out_general2 <- 1/(1+exp(-in_general2))
out_general2
```


## Prediction (3) - versicolor
Trainset
```{r, echo=FALSE}
in_versicolor1 <- informations[9,1] + (informations[10,1]*out_general1)
out_versicolor1 <- 1/(1+exp(-in_versicolor1))
out_versicolor1
```
Testset
```{r, echo=FALSE}
in_versicolor2 <- informations2[9,1] + (informations2[10,1]*out_general2)
out_versicolor2 <- 1/(1+exp(-in_versicolor2))
out_versicolor2
```


## Prediction (4) - virginica
Trainset
```{r, echo=FALSE}
in_virginica1 <- informations[11,1] + (informations[12,1]*out_general1) 
out_virginica1 <- 1/(1+exp(-in_virginica1))
out_virginica1
```
Testset
```{r, echo=FALSE}
in_virginica2 <- informations2[11,1] + (informations2[12,1]*out_general2) 
out_virginica2 <- 1/(1+exp(-in_virginica2))
out_virginica2
```


## Prediction (5) - setosa
Trainset
```{r, echo=FALSE}
in_setosa1 <- informations[13,1] + (informations[14,1]*out_general1)
out_setosa1 <- 1/(1+exp(-in_setosa1))
out_setosa1
```
Testset
```{r, echo=FALSE}
in_setosa2 <- informations2[13,1] + (informations2[14,1]*out_general2)
out_setosa2 <- 1/(1+exp(-in_setosa2))
out_setosa2
```


## Table de confusion (1)

```{r, echo=FALSE}
set.seed(123)
iris.nn <- nnet(Species ~ .,data = trainset, size = 3)
```

## Table de confusion (2)
```{r, echo=FALSE}
iris.predict <- predict(iris.nn, trainset, type = 'class')
nn.table <- table(iris.predict, trainset$Species)
nn.table


iris.predict2 <- predict(iris.nn, testset, type = 'class')
nn.table2 <- table(iris.predict2, testset$Species)
nn.table2
adjustedRandIndex(iris.predict2, testset$Species)
```

## Adjusted Rand Index

Trainset
```{r, echo=FALSE}
adjustedRandIndex(iris.predict, trainset$Species)
```
Testset
```{r, echo=FALSE}
adjustedRandIndex(iris.predict2, testset$Species)
```


```{r, echo=FALSE}

```

```{r, echo=FALSE}

```

## Lien

https://www.youtube.com/watch?v=YQgVgYcoJHY (début)

https://www.youtube.com/watch?v=-Vs9Vae2KI0 (compléter)
